<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Davilkus Games — Secret Hub</title>
    <meta name="description" content="Explore our new secret game!" />

    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    
    <link rel="canonical" href="https://davilkusgames.com/secret/" />

    <!-- Open Graph / Social Preview -->
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="ru_RU">
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Davilkus Games — Secret Hub" />
    <meta property="og:site_name" content="Davilkus Games" />
    <meta property="og:description" content="Explore our new secret game!" />
    <meta property="og:url" content="https://davilkusgames.com/secret/" />
    <meta property="og:image" content="https://davilkusgames.com/assets/logo.webp" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:alt" content="Davilkus Games logo" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@DavilkusGames" />
    <meta name="twitter:title" content="Davilkus Games — Secret Hub" />
    <meta name="twitter:description" content="Explore our new Secret Game!" />
    <meta name="twitter:image" content="https://davilkusgames.com/assets/logo.webp" />

    <meta name="theme-color" content="#0B0F1A" />

    <!-- Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui', 'Apple Color Emoji'] },
                    colors: {
                        bg: '#0B0F1A',
                        panel: '#0F1524',
                        ink: '#E8EAF2',
                        brand: '#2563eb',
                        brandDark: '#1e40af',
                        header: '#070a12',
                        line: '#1b2336'
                    },
                    boxShadow: { soft: '0 6px 30px rgba(0,0,0,0.35)' }
                }
            }
        }
    </script>

    <!-- GSAP -->
    <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

    <!-- i18next + detector -->
    <script defer src="https://cdn.jsdelivr.net/npm/i18next@23.11.5/dist/umd/i18next.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.0/i18nextBrowserLanguageDetector.min.js"></script>

    <style>
        body {
            visibility: hidden;
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale; 
        }

        /* Consistent Vignette */
        body::after {
            content: "";
            position: fixed;
            inset: -100px;
            pointer-events: none;
            z-index: 5; 
            background: radial-gradient(circle at 50% 50%, transparent 40%, rgba(0,0,0,0.6) 100%);
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px
        }

        ::-webkit-scrollbar-track {
            background: #0b0f1a
        }

        ::-webkit-scrollbar-thumb {
            background: #1b2336;
            border-radius: 10px
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2a3552
        }

        ::selection {
            background: #2563eb;
            color: #ffffff;
        }
        
        html {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        h1, h2, h3, .font-semibold, .font-bold {
            letter-spacing: -0.015em;
        }

        canvas {
            image-rendering: pixelated; 
        }
        
        /* RESTORED ANIMATIONS (Exact copy from 404 Reference) */
        
        @keyframes flicker {
            0%, 19%, 21%, 23%, 80%, 100% { opacity: 1 }
            20%, 22% { opacity: .55 }
            81% { opacity: .85 }
        }
        .flicker {
            animation: flicker 6s infinite;
        }
        
        .lamp404 {
            position: relative;
            display: inline-block;
            isolation: isolate;          
            filter: drop-shadow(0 0 14px rgba(255,255,255,0.06));
            animation: lampFlicker 3.8s infinite;
            will-change: opacity, filter, transform;
        }
        
        .lamp404::before {
            content: "";
            position: absolute;
            inset: -10%;
            z-index: 1;
            pointer-events: none;
            background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.10), transparent 55%);
            opacity: 0.25;
            filter: blur(10px);
            animation: glowPulse 3.8s infinite;
        }

        @keyframes lampFlicker {
            0%   { opacity: 1;   filter: drop-shadow(0 0 18px rgba(255,255,255,.07)); transform: translateY(0); }
            6%   { opacity: .92; }
            7%   { opacity: .55; }
            8%   { opacity: .98; }
            16%  { opacity: .86; }
            17%  { opacity: .30; }
            18%  { opacity: .95; }
            27%  { opacity: .88; }
            28%  { opacity: .62; transform: translateY(.5px); }
            29%  { opacity: .98; transform: translateY(0); }
            44%  { opacity: .92; }
            45%  { opacity: .40; }
            46%  { opacity: 1; }
            62%  { opacity: .90; }
            63%  { opacity: .20; }
            64%  { opacity: .95; }
            79%  { opacity: .88; }
            80%  { opacity: .50; }
            81%  { opacity: 1; }
            100% { opacity: .94; }
        }
        
        @keyframes glowPulse {
            0%   { opacity: .20; transform: scale(1); }
            28%  { opacity: .12; transform: scale(0.98); }
            29%  { opacity: .26; transform: scale(1.02); }
            63%  { opacity: .10; transform: scale(0.985); }
            64%  { opacity: .28; transform: scale(1.03); }
            100% { opacity: .20; transform: scale(1); }
        }

        .tv-noise {
            position: relative;
            isolation: isolate;
            animation: horrorFlicker 4.2s infinite, microShake 0.80s infinite;
            text-shadow: -2px 0 0 rgba(255,80,80,0.35), 2px 0 0 rgba(90,160,255,0.28);
        }
        
        .tv-noise::before {
            content: "";
            position: absolute;
            inset: 0;
            z-index: 2;
            pointer-events: none;
            background: repeating-linear-gradient(
                to bottom,
                rgba(255,255,255,0.06) 0px,
                rgba(255,255,255,0.06) 1px,
                rgba(0,0,0,0.18) 2px,
                rgba(0,0,0,0.18) 4px
            );
            mix-blend-mode: overlay;
            opacity: 0.45;
            animation: scanLines 1.2s linear infinite;
        }

        .tv-noise::after {
            content: attr(data-text);
            position: absolute;
            inset: 0;
            z-index: 3;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.35' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
            background-size: 140px 140px;
            background-repeat: repeat;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            -webkit-text-fill-color: transparent;
            mix-blend-mode: screen;
            opacity: .55;
            animation: noiseJitter .09s steps(2) infinite;
        }

        .tv-horror {
          position: relative;
          display: inline-block;
          isolation: isolate;
          will-change: transform, filter, opacity;
          animation: horrorFlicker 3.2s infinite, microShake 0.28s infinite;
        }
        
        .tv-horror::before {
          content:"";
          position:absolute;
          inset:-2%;
          z-index:2;
          pointer-events:none;
          background:
            repeating-linear-gradient(
              to bottom,
              rgba(255,255,255,0.06) 0px,
              rgba(255,255,255,0.06) 1px,
              rgba(0,0,0,0.18) 2px,
              rgba(0,0,0,0.18) 4px
            ),
            radial-gradient(circle at 50% 45%, rgba(255,255,255,0.08), transparent 55%);
          mix-blend-mode: overlay;
          opacity: 0.45;
          filter: blur(0.2px);
          animation: scanCreep 1.25s linear infinite;
        }
        
        .tv-horror::after {
          content: attr(data-text);
          position:absolute;
          inset:0;
          z-index:4;
          pointer-events:none;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.1' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
          background-size: 140px 140px;
          background-repeat: repeat;
          -webkit-background-clip:text;
          background-clip:text;
          color: transparent;
          mix-blend-mode: screen;
          opacity: 0.35;
          animation: grainJitter 0.5s steps(2) infinite;
        }
        
        .tv-horror[data-text] {
          text-shadow:
            -2px 0 0 rgba(255,80,80,0.35),
             2px 0 0 rgba(90,160,255,0.28),
             0 1px 0 rgba(140,255,180,0.12);
          filter: drop-shadow(0 0 24px rgba(255,255,255,0.05));
        }
        
        @keyframes horrorFlicker {
          0%{opacity:1} 8%{opacity:.85} 9%{opacity:.55} 10%{opacity:1}
          28%{opacity:.90} 29%{opacity:.60} 30%{opacity:1}
          55%{opacity:.88} 56%{opacity:.45} 57%{opacity:1}
          100%{opacity:.92}
        }

        @keyframes grainJitter {
          0%{background-position:0 0; opacity:.45}
          25%{background-position:-22px 14px; opacity:.70}
          50%{background-position:18px -10px; opacity:.52}
          75%{background-position:-10px -26px; opacity:.78}
          100%{background-position:0 0; opacity:.55}
        }
        
        @keyframes scanCreep {
          0%{transform:translateY(0)}
          50%{transform:translateY(6px)}
          51%{transform:translateY(-3px)}
          100%{transform:translateY(0)}
        }
        
        @keyframes scanLines {
            0%   { background-position-y: 0; }
            100% { background-position-y: 6px; }
        }

        @keyframes noiseJitter {
          0%{background-position:0 0; opacity:.40}
          25%{background-position:-22px 14px; opacity:.70}
          50%{background-position:18px -10px; opacity:.50}
          75%{background-position:-10px -26px; opacity:.80}
          100%{background-position:0 0; opacity:.55}
        }

        @keyframes microShake {
          0%{transform:translate(0,0) skewX(0deg)}
          8%{transform:translate(0.6px,-0.4px) skewX(-0.2deg)}
          16%{transform:translate(-0.7px,0.3px) skewX(0.25deg)}
          24%{transform:translate(0.4px,0.2px) skewX(-0.1deg)}
          32%{transform:translate(-0.5px,-0.2px) skewX(0.15deg)}
          40%{transform:translate(0,0) skewX(0deg)}
          41%{transform:translate(-6px,1px) skewX(-1.2deg)}
          42%{transform:translate(5px,-1px) skewX(1.1deg)}
          43%{transform:translate(0,0) skewX(0deg)}
          60%{transform:translate(0.5px,0) skewX(-0.2deg)}
          68%{transform:translate(-0.4px,0.3px) skewX(0.2deg)}
          76%{transform:translate(0.3px,-0.3px) skewX(-0.1deg)}
          84%{transform:translate(0,0) skewX(0deg)}
          85%{transform:translate(4px,0.5px) skewX(0.9deg)}
          86%{transform:translate(-5px,-0.5px) skewX(-1deg)}
          87%{transform:translate(0,0) skewX(0deg)}
          100%{transform:translate(0,0) skewX(0deg)}
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: .001ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: .001ms !important;
            }
            .tv-horror, .tv-horror::before, .tv-horror::after, .lamp404, .lamp404::before, .tv-noise, .tv-noise::before, .tv-noise::after {
                animation: none !important;
            }
        }
        .ghost-img {
          position: absolute;
          width: clamp(80px, 10vw, 180px);
          height: auto;
          opacity: 0;
          transform: translateZ(0) scale(0.98);
          filter: contrast(1.1) brightness(0.9) saturate(0.8)
                  drop-shadow(0 0 18px rgba(255,255,255,0.08));
          mix-blend-mode: screen;
          will-change: opacity, transform, filter;
          animation: ghostFlicker 2s linear forwards;
        }
        
        @keyframes ghostFlicker {
          0%   { opacity: 0;   transform: scale(0.98) translateY(1px); filter: blur(0.6px) brightness(0.75); }
          8%   { opacity: .85; transform: scale(1.00) translateY(0);   filter: blur(0.2px) brightness(0.95); }
          14%  { opacity: .25; }
          18%  { opacity: .95; transform: scale(1.01); }
          40%  { opacity: .35; }
          55%  { opacity: .98; }
          70%  { opacity: .20; transform: scale(1.02) translateY(-1px); }
          86%  { opacity: .85; }
          100% { opacity: 0;   transform: scale(1.02); filter: blur(0.8px) brightness(0.7); }
        }

    </style>
</head>

<body class="bg-bg text-ink font-sans antialiased min-h-screen flex flex-col">
    
    <!-- Header -->
    <header class="fixed top-0 inset-x-0 z-50 bg-header/95 backdrop-blur border-b border-line">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <a href="/" class="flex items-center gap-3 group">
                <img src="/assets/logo.webp" alt="Davilkus Games logo" width="64" height="64"
                    class="h-9 w-9 rounded-2xl" />
                <span class="text-lg font-semibold tracking-tight group-hover:text-white" data-i18n="brand">Davilkus
                    Games</span>
            </a>

            <div class="hidden md:flex items-center gap-6 text-sm">
                <nav class="flex items-center gap-8">
                    <a href="/games/" class="hover:opacity-80 transition" data-i18n="nav.games">Games</a>
                    <a href="/#about" class="hover:opacity-80 transition" data-i18n="nav.about">About</a>
                    <a href="/#contact" class="hover:opacity-80 transition" data-i18n="nav.contact">Contact Us</a>
                </nav>
                <button id="langToggle"
                    class="relative inline-flex items-center bg-header/60 border border-line rounded-full px-1 py-1 w-[4.75rem] h-8 select-none focus:outline-none focus:ring-2 focus:ring-brand transition"
                    aria-label="Toggle language">
                    <span class="flex-1 text-center text-[10px]">EN</span>
                    <span class="flex-1 text-center text-[10px]">RU</span>
                    <span id="langThumb"
                        class="absolute inset-y-1 left-1 w-1/2 rounded-full bg-brand transition-all"></span>
                </button>
            </div>

            <div class="md:hidden flex items-center gap-2">
                <button id="langToggleMobile"
                    class="relative inline-flex items-center bg-header/60 border border-line rounded-full px-1 py-1 w-[4.25rem] h-7 select-none focus:outline-none focus:ring-2 focus:ring-brand transition"
                    aria-label="Toggle language">
                    <span class="flex-1 text-center text-[9px]">EN</span>
                    <span class="flex-1 text-center text-[9px]">RU</span>
                    <span id="langThumbMobile"
                        class="absolute inset-y-1 left-1 w-1/2 rounded-full bg-brand transition-all"></span>
                </button>
                <button id="menuBtn"
                    class="p-2 rounded-lg hover:bg-panel/70 focus:outline-none focus:ring-2 focus:ring-brand"
                    aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
                    <img src="/assets/icons/menu.svg" alt="menu" class="w-6 h-6" />
                </button>
            </div>
        </div>

        <div id="mobileMenu" class="hidden md:hidden border-t border-line bg-header/95 menu-overlay" aria-hidden="true">
            <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col gap-2 text-sm">
                <a href="/games/" class="py-3 px-3 rounded-lg hover:bg-panel/70" data-i18n="nav.games">Games</a>
                <a href="/#about" class="py-3 px-3 rounded-lg hover:bg-panel/70" data-i18n="nav.about">About</a>
                <a href="/#contact" class="py-3 px-3 rounded-lg hover:bg-panel/70" data-i18n="nav.contact">Contact
                    Us</a>
            </div>
        </div>
    </header>
    
    <main class="pt-24 flex-1 flex flex-col items-center justify-center px-4 pb-12">
        <div class="flex flex-col items-center gap-6 w-full max-w-lg">
          <!-- Title with translation -->
          <div class="text-3xl md:text-4xl font-semibold tracking-tight lamp404 tv-noise tv-horror text-ink/90 select-none" data-text="Secret Hub" data-i18n="game.title">
            Secret Hub
          </div>
        
          <!-- Score HUD with translations -->
          <div class="w-full flex items-center justify-between gap-3">
              <div class="flex items-stretch gap-3">
                <div class="px-4 py-2 rounded-2xl bg-panel/70 border border-line shadow-soft backdrop-blur-sm">
                  <div class="text-[10px] uppercase tracking-wider text-ink/50" data-i18n="game.score">Score</div>
                  <div id="scoreValue" class="text-lg font-semibold tracking-tight text-ink">0</div>
                </div>
            
                <div class="px-4 py-2 rounded-2xl bg-panel/70 border border-line shadow-soft backdrop-blur-sm">
                  <div class="text-[10px] uppercase tracking-wider text-ink/50" data-i18n="game.hiscore">Hi-score</div>
                  <div id="hiScoreValue" class="text-lg font-semibold tracking-tight text-ink">0</div>
                </div>
              </div>
            
              <div class="text-xs text-ink/50 select-none hidden sm:block" data-i18n="game.controls">
                Use ↑ ↓ ← →
              </div>
          </div>
        
          <!-- Game Canvas -->
          <canvas width="400" height="400" id="game" class="block rounded-2xl bg-header/40 border border-line shadow-soft max-w-full h-auto"></canvas>
        </div>
        
        <!-- Fullscreen reveal overlay -->
        <div id="scoreOverlay" class="hidden fixed inset-0 z-[9999] bg-black">
              <img
                id="scoreOverlayImg"
                src=""
                alt="Unlock"
                class="absolute w-full h-full inset-0 object-contain md:object-cover"
              />
            
              <div class="absolute inset-0 bg-black/35"></div>
            
              <div class="absolute top-4 right-4 flex items-center gap-2">
                <button
                  id="overlayClose"
                  class="px-4 py-2 rounded-2xl bg-header/70 border border-line text-sm text-ink/90 hover:text-ink hover:bg-panel/60 transition shadow-soft backdrop-blur cursor-pointer z-50"
                  type="button"
                  data-i18n="game.close"
                >
                  Close (Esc)
                </button>
              </div>
            
              <div class="absolute bottom-6 left-1/2 -translate-x-1/2 px-4 py-2 rounded-2xl bg-header/70 border border-line text-xs text-ink/80 shadow-soft backdrop-blur" data-i18n="game.unlocked">
                ЧПУРКА unlocked
              </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-header border-t border-line mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
            <div>
                <div class="text-base md:text-lg">© 2025 Davilkus Games</div>
                <div class="mt-2 flex items-center gap-4 text-xs">
                    <a href="/privacy-policy/" class="opacity-60 hover:opacity-80 transition">Privacy Policy</a>
                    <a href="/cookie-policy/" class="opacity-60 hover:opacity-80 transition">Cookie Policy</a>
                </div>
            </div>
            <div class="flex items-center gap-5">
                <a href="https://discord.gg/y3hE847S" class="opacity-80 hover:opacity-100" aria-label="Discord"><img
                        src="/assets/icons/discord.svg" width="32" height="32" loading="lazy" decoding="async"
                        class="w-8 h-8" alt="Discord" /></a>
                <a href="https://t.me/davilkus_games_news" class="opacity-80 hover:opacity-100"
                    aria-label="Telegram"><img src="/assets/icons/telegram.svg" width="32" height="32" loading="lazy"
                        decoding="async" class="w-8 h-8" alt="Telegram" /></a>
                <a href="https://www.youtube.com/@davilkusgames" class="opacity-80 hover:opacity-100"
                    aria-label="YouTube"><img src="/assets/icons/youtube.svg" width="32" height="32" loading="lazy"
                        decoding="async" class="w-8 h-8" alt="YouTube" /></a>
                <a href="https://x.com/DavilkusGames" class="opacity-80 hover:opacity-100" aria-label="X"><img
                        src="/assets/icons/x.svg" width="32" height="32" loading="lazy" decoding="async" class="w-8 h-8"
                        alt="X" /></a>
                <a href="https://github.com/DavilkusGames" class="opacity-80 hover:opacity-100" aria-label="GitHub"><img
                        src="/assets/icons/github.svg" width="32" height="32" loading="lazy" decoding="async"
                        class="w-8 h-8" alt="GitHub" /></a>
                <a href="https://vk.com/davilkusgames" class="opacity-80 hover:opacity-100" aria-label="VK"><img
                        src="/assets/icons/vk.svg" width="32" height="32" loading="lazy" decoding="async"
                        class="w-8 h-8" alt="VK" /></a>
            </div>
        </div>
    </footer>
    <div id="ghostLayer" class="pointer-events-none fixed inset-0 z-[60] overflow-hidden"></div>

    <script>
        // --- GAME LOGIC ---
        var canvas = document.getElementById('game');
        var context = canvas.getContext('2d');
        // --- Ghost popups (random images on page, NOT on the game field) ---
                    (function initGhosts(){
  function start() {
    var canvas = document.getElementById('game');          // заново получаем
    var ghostLayer = document.getElementById('ghostLayer'); // заново получаем

    if (!canvas || !ghostLayer) {
      // если вдруг ещё не готово — попробуем чуть позже
      setTimeout(start, 150);
      return;
    }

    var ghostSources = [
      'tutols.webp',
      'omega.webp',
      //'paylife.webp',
      'hranitel.webp',
      'baget.webp'
    ];

    function getForbiddenRect() {
      var r = canvas.getBoundingClientRect();
      var pad = 24;
      return { left: r.left - pad, top: r.top - pad, right: r.right + pad, bottom: r.bottom + pad };
    }
    function rectsIntersect(ax1, ay1, ax2, ay2, b) {
      return !(ax2 < b.left || ax1 > b.right || ay2 < b.top || ay1 > b.bottom);
    }

    function spawnGhostOnce() {
      // не спавним, если открыт full-screen overlay на 94
      var overlay = document.getElementById('scoreOverlay');
      if (overlay && !overlay.classList.contains('hidden')) return;

      var img = document.createElement('img');
      img.className = 'ghost-img';
      img.alt = '';
      img.decoding = 'async';
      img.loading = 'eager';
      img.src = ghostSources[Math.floor(Math.random() * ghostSources.length)];

      var size = 80 + Math.floor(Math.random() * 140); // 80..220
      img.style.width = size + 'px';

      var rot = (Math.random() * 14 - 7).toFixed(2);
      img.style.transform = 'translateZ(0) scale(0.98) rotate(' + rot + 'deg)';

      var forbidden = getForbiddenRect();
      var vw = window.innerWidth, vh = window.innerHeight;
      var w = size;
      var h = Math.round(size * (0.8 + Math.random() * 0.6));

      var tries = 40, x = 0, y = 0;
      while (tries--) {
        x = Math.floor(Math.random() * Math.max(1, vw - w));
        y = Math.floor(Math.random() * Math.max(1, vh - h));
        if (!rectsIntersect(x, y, x + w, y + h, forbidden)) break;
      }

      img.style.left = x + 'px';
      img.style.top = y + 'px';

      ghostLayer.appendChild(img);

      setTimeout(function () {
        if (img && img.parentNode) img.parentNode.removeChild(img);
      }, 2200);
    }

    var ghostTimer = null;
    function scheduleGhosts() {
      if (ghostTimer) clearTimeout(ghostTimer);
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

      var nextIn = 700 + Math.floor(Math.random() * 2200);
      ghostTimer = setTimeout(function () {
        if (Math.random() < 0.75) spawnGhostOnce();
        if (Math.random() < 0.15) setTimeout(spawnGhostOnce, 120 + Math.random() * 240);
        scheduleGhosts();
      }, nextIn);
    }

    window.addEventListener('resize', scheduleGhosts);
    scheduleGhosts();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', start);
  } else {
    start();
  }
})();
        var grid = 16;
        var count = 0;
        var score = 0;
        var hiScore = 0;
        var overlayShown = false;
        
        var scoreEl = document.getElementById('scoreValue');
        var hiScoreEl = document.getElementById('hiScoreValue');
        var overlay = document.getElementById('scoreOverlay');
        var overlayImg = document.getElementById('scoreOverlayImg');
        var overlayClose = document.getElementById('overlayClose');
        
        // REQ: Only 2 images (0 and 1)
        var secretImages = ['churka_0.webp', 'churka_1.webp'];

        function loadHiScore() {
          try {
            var saved = localStorage.getItem('snake_hi_score');
            hiScore = saved ? parseInt(saved, 10) : 0;
            if (!Number.isFinite(hiScore)) hiScore = 0;
          } catch (_) {
            hiScore = 0;
          }
          if (hiScoreEl) hiScoreEl.textContent = String(hiScore);
        }
        loadHiScore();
        
        function saveHiScore() {
          try { localStorage.setItem('snake_hi_score', String(hiScore)); } catch (_) {}
        }
        
        function setScore(n) {
          score = n;
          if (scoreEl) scoreEl.textContent = String(score);
        
          if (score > hiScore) {
            hiScore = score;
            if (hiScoreEl) hiScoreEl.textContent = String(hiScore);
            saveHiScore();
          }
        
          // Reveal at 94 (once per attempt)
          if (!overlayShown && score === 94) {
            overlayShown = true;
            
            // Random Image Logic
            var randomIdx = Math.floor(Math.random() * secretImages.length);
            if (overlayImg) overlayImg.src = secretImages[randomIdx];

            if (overlay) overlay.classList.remove('hidden');
        
            // Pause snake briefly
            snake.dx = 0;
            snake.dy = 0;
          }
        }
        
        function hideOverlay() {
          if (overlay) overlay.classList.add('hidden');
        }
        
        if (overlayClose) overlayClose.addEventListener('click', hideOverlay);
        
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' && overlay && !overlay.classList.contains('hidden')) {
            hideOverlay();
          }
        });

        var snake = { x: 160, y: 160, dx: grid, dy: 0, cells: [], maxCells: 4 };
        var apple = { x: 320, y: 320 };
        
        function getRandomInt(min, max) {
          return Math.floor(Math.random() * (max - min)) + min;
        }
        
        function loop() {
          requestAnimationFrame(loop);
          if (++count < 4) return;
          count = 0;
          context.clearRect(0,0,canvas.width,canvas.height);
        
          snake.x += snake.dx;
          snake.y += snake.dy;
        
          if (snake.x < 0) snake.x = canvas.width - grid;
          else if (snake.x >= canvas.width) snake.x = 0;
        
          if (snake.y < 0) snake.y = canvas.height - grid;
          else if (snake.y >= canvas.height) snake.y = 0;
        
          snake.cells.unshift({x: snake.x, y: snake.y});
          if (snake.cells.length > snake.maxCells) snake.cells.pop();
        
          context.fillStyle = '#ef4444';
          context.fillRect(apple.x, apple.y, grid-1, grid-1);
        
          context.fillStyle = '#22c55e';
          snake.cells.forEach(function(cell, index) {
            context.fillRect(cell.x, cell.y, grid-1, grid-1);
            if (cell.x === apple.x && cell.y === apple.y) {
              snake.maxCells++;
              setScore(score + 1);
              apple.x = getRandomInt(0, 25) * grid;
              apple.y = getRandomInt(0, 25) * grid;
            }
            for (var i = index + 1; i < snake.cells.length; i++) {
              if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
                snake.x = 160; snake.y = 160; snake.cells = []; snake.maxCells = 4;
                snake.dx = grid; snake.dy = 0;
                setScore(0);
                overlayShown = false;
                apple.x = getRandomInt(0, 25) * grid;
                apple.y = getRandomInt(0, 25) * grid;
              }
            }
          });
        }
        
        document.addEventListener('keydown', function(e) {
            if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.key) > -1) e.preventDefault();
            if ((e.key === 'ArrowLeft' || e.key === 'a') && snake.dx === 0) { snake.dx = -grid; snake.dy = 0; }
            else if ((e.key === 'ArrowUp' || e.key === 'w') && snake.dy === 0) { snake.dy = -grid; snake.dx = 0; }
            else if ((e.key === 'ArrowRight' || e.key === 'd') && snake.dx === 0) { snake.dx = grid; snake.dy = 0; }
            else if ((e.key === 'ArrowDown' || e.key === 's') && snake.dy === 0) { snake.dy = grid; snake.dx = 0; }
        });
        
        requestAnimationFrame(loop);


        // --- SITE LOGIC (i18n, Menu) ---
        const hasGSAP = () => !!window.gsap;
        const menuBtn = document.getElementById('menuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        let menuOpen = false; let outsideHandler; let trapHandler; let first; let last;
        const focusables = 'a,button,[tabindex]:not([tabindex="-1"])';

        function openMenu() {
            menuOpen = true;
            if (hasGSAP()) gsap.killTweensOf(mobileMenu);
            mobileMenu.classList.remove('hidden');
            mobileMenu.setAttribute('aria-hidden', 'false');
            menuBtn.setAttribute('aria-expanded', 'true');
            if (hasGSAP()) gsap.fromTo(mobileMenu, { height: 0, opacity: 0 }, { height: 'auto', opacity: 1, duration: 0.35, ease: 'power3.out' });
            const focusableEls = mobileMenu.querySelectorAll(focusables);
            first = focusableEls[0]; last = focusableEls[focusableEls.length - 1];
            first && first.focus();
            trapHandler = (e) => {
                if (e.key !== 'Tab' || !first || !last) return;
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            };
            document.addEventListener('keydown', trapHandler);
            outsideHandler = (e) => { if (mobileMenu.contains(e.target) || menuBtn.contains(e.target)) return; closeMenu(); };
            document.addEventListener('pointerdown', outsideHandler, { passive: true });
        }
        function closeMenu() {
            menuOpen = false;
            if (hasGSAP()) gsap.killTweensOf(mobileMenu);
            if (hasGSAP()) gsap.to(mobileMenu, { height: 0, opacity: 0, duration: 0.3, ease: 'power3.inOut', onComplete: () => mobileMenu.classList.add('hidden') });
            else mobileMenu.classList.add('hidden');
            mobileMenu.setAttribute('aria-hidden', 'true');
            menuBtn.setAttribute('aria-expanded', 'false');
            menuBtn.focus();
            document.removeEventListener('keydown', trapHandler);
            document.removeEventListener('pointerdown', outsideHandler);
            first = last = null;
        }
        menuBtn && menuBtn.addEventListener('click', () => { menuOpen ? closeMenu() : openMenu(); });
        document.addEventListener('keydown', e => (e.key === 'Escape' && menuOpen) && closeMenu());

        // REQ: Added Translations for game labels
        const resources = {
            en: {
                translation: {
                    meta: { title: 'Davilkus Games — Secret Hub' },
                    brand: 'Davilkus Games',
                    nav: { games: 'Games', about: 'About', contact: 'Contact Us' },
                    game: {
                        title: 'Secret Hub',
                        score: 'Score',
                        hiscore: 'Hi-score',
                        controls: 'Use ↑ ↓ ← →',
                        unlocked: 'ЧПУРКА unlocked',
                        close: 'Close (Esc)'
                    }
                }
            },
            ru: {
                translation: {
                    meta: { title: 'Davilkus Games — Secret Hub' },
                    brand: 'Davilkus Games',
                    nav: { games: 'Игры', about: 'О нас', contact: 'Контакты' },
                    game: {
                        title: 'Секретный Хаб',
                        score: 'Счет',
                        hiscore: 'Рекорд',
                        controls: 'Используйте ↑ ↓ ← →',
                        unlocked: 'ЧПУРКА разблокирована',
                        close: 'Закрыть (Esc)'
                    }
                }
            }
        };

        function localize() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const val = i18next.t(key);
                if (val) el.innerHTML = val;
            });
            // Update data-text for the glitch effect on the title
            const titleEl = document.querySelector('[data-i18n="game.title"]');
            if(titleEl) titleEl.setAttribute('data-text', i18next.t('game.title'));
        }

        function setLangUI(lang) {
            const thumb = document.getElementById('langThumb');
            const thumbM = document.getElementById('langThumbMobile');
            const isRU = lang && lang.startsWith('ru');
            if (thumb) { thumb.classList.toggle('right-1', !isRU); thumb.classList.toggle('left-1', isRU); }
            if (thumbM) { thumbM.classList.toggle('right-1', !isRU); thumbM.classList.toggle('left-1', isRU); }
        }

        function setUrlLangParam(lang) {
            const url = new URL(window.location.href);
            url.searchParams.set('lang', lang);
            window.history.replaceState({}, '', url);
        }

        function bindLangToggle(id) {
            const btn = document.getElementById(id);
            if (!btn) return;
            btn.addEventListener('click', () => {
                const newLang = (i18next.language || 'en').startsWith('ru') ? 'en' : 'ru';
                i18next.changeLanguage(newLang, () => {
                    try { localStorage.setItem('i18nextLng', newLang); } catch (_) { }
                    document.documentElement.lang = newLang.startsWith('ru') ? 'ru' : 'en';
                    localize();
                    document.title = i18next.t('meta.title');
                    setLangUI(newLang);
                    setUrlLangParam(newLang);
                });
            });
        }

        function loadCounter() {
            if (document.getElementById('counterjs')) return;
            const s = document.createElement('script');
            s.id = 'counterjs'; s.defer = true; s.src = 'https://cdn.counter.dev/script.js';
            s.dataset.id = 'cc931e21-a972-4ffe-aaf1-52b0f23da9d3';
            s.dataset.utcoffset = String(-new Date().getTimezoneOffset() / 60);
            s.dataset.path = '/secret/';
            document.head.appendChild(s);
        }

        function initFx() {
            const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (reduced || !window.gsap) return;
            gsap.from('header', { y: -60, opacity: 0, duration: 0.6, ease: 'power2.out' });
            gsap.from('.lamp404', { y: 12, opacity: 0, duration: 0.6, delay: 0.1, ease: 'power2.out' });
            gsap.from('canvas', { scale: 0.95, opacity: 0, duration: 0.5, delay: 0.2, ease: 'power2.out' });
        }

        window.addEventListener('DOMContentLoaded', () => {
            i18next
                .use(window.i18nextBrowserLanguageDetector)
                .init({
                    resources,
                    fallbackLng: 'en',
                    detection: { order: ['querystring', 'cookie', 'localStorage', 'navigator'], caches: ['localStorage', 'cookie'], lookupQuerystring: 'lang' }
                }, () => {
                    const lang = i18next.language || 'en';
                    document.documentElement.lang = lang.startsWith('ru') ? 'ru' : 'en';
                    localize();
                    document.body.style.visibility = 'visible';
                    document.title = i18next.t('meta.title');
                    setLangUI(lang);
                    bindLangToggle('langToggle');
                    bindLangToggle('langToggleMobile');
                    initFx();
                });
            loadCounter();
        });
    </script>
    


</body>
</html>
